

CXXLINK = $(CXX) $(CXXFLAGS) -o $@
LDFLAGS = @LDFLAGS@ 
LDADD = @arch_ld_flags@
LIBS = @LIBS@
INCLUDES = @INCLUDES@
GEMLIBS = @GEMLIBS@

PREFIX = /usr/local
PDLIBDIR = $(PREFIX)/lib/pd
DOCBASE = /share/doc

SYSTEMDOCS = $(DESTDIR)/$(PREFIX)/$(DOCBASE)/gem

TARG_DIR = ../Manips  ../Particles ../Base ../MarkEx ../Pixes ../Controls ../Nongeos  ../Geos ../TV

OBJECTS = ../Manips/*.o \
         ../Particles/*.o \
         ../Base/*.o \
         ../MarkEx/*.o \
         ../Pixes/*.o \
         ../Controls/*.o \
         ../Nongeos/*.o \
	 ../TV/*.o \
         ../Geos/*.o \
#OBJECTS = ../Objects/*.o


all: subdirs Gem.pd_linux

cleangem:
	@rm -f Gem.pd_linux

Gem.pd_linux: cleangem $(Gem_pd_DEPENDENCIES)
	$(CXXLINK) $(LDFLAGS) $(OBJECTS) $(LDADD) $(LIBS) $(INCLUDES)
	strip --strip-unneeded Gem.pd_linux
	cp Gem.pd_linux ../../


subdirs:
	for d in ${TARG_DIR}; do \
	    echo ""\
	    echo "----------$$d----------"; \
	    cd $$d && ${MAKE} || exit -1; \
	done


depend:
	@for d in ${TARG_DIR}; do \
	    echo "\n----------$$d----------"; \
	    cd $$d ; ${MAKE} depend; cd ../Gnu; \
	done


clean:
	@for d in ${TARG_DIR}; do \
	    echo "\n----------$$d----------"; \
	    cd $$d ; ${MAKE} clean;cd ../Gnu; \
	done
	-rm Gem.pd_linux ../../Gem.pd_linux *~


install: installdocs uncvsdocs
	install -m644 -D ../../Gem.pd_linux $(DESTDIR)/$(PDLIBDIR)/externs/Gem.pd_linux


installdocs:
	install -d $(SYSTEMDOCS)
	install -m644 ../../doc/*.* $(SYSTEMDOCS)

	install -d $(DESTDIR)/$(PDLIBDIR)/doc/5.reference/Gem
	install -m644 ../../help/*.* $(DESTDIR)/$(PDLIBDIR)/doc/5.reference/Gem

	cp -r ../../examples $(SYSTEMDOCS)
	cp -r ../../manual $(SYSTEMDOCS)

	ln -fs ../../../$(DOCBASE)/gem $(DESTDIR)/$(PDLIBDIR)/doc/

uncvsdocs:
	touch $(SYSTEMDOCS)/CVS
	rm -rf `find $(SYSTEMDOCS) -name *CVS*`

distclean: clean
	@for d in ${TARG_DIR}; do \
	    echo "\n----------$$d----------"; \
	    cd $$d ; ${MAKE} distclean;cd ../Gnu; \
	done
	-rm config.cache config.log config.status Makefile
	./makeauxlibs clean
	cp Makefile.clean Makefile


