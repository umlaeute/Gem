#use "configure" to generate a Makefile out of this

CXXLINK = $(CXX) $(CXXFLAGS) -o $@
LDFLAGS = @LDFLAGS@ 
LDADD = @arch_ld_flags@
LIBS = @LIBS@
INCLUDES = @INCLUDES@

PDLIBDIR = @prefix@@PDBASE@
DOCBASE = @DOCBASE@

#SYSTEMDOCS = @prefix@@DOCBASE@/gem

TARG_DIR = ../Manips  ../Particles ../Base ../MarkEx ../Pixes ../Controls ../Nongeos  ../Geos ../openGL

OBJECTS = ../Manips/*.o \
         ../Particles/*.o \
         ../Base/*.o \
         ../MarkEx/*.o \
         ../Pixes/*.o \
         ../Controls/*.o \
         ../Nongeos/*.o \
         ../Geos/*.o \
	 ../openGL/*.o \
#OBJECTS = ../Objects/*.o


all: subdirs Gem.pd_linux

cleangem:
	@rm -f Gem.pd_linux

Gem.pd_linux: cleangem $(Gem_pd_DEPENDENCIES)
	$(CXXLINK) $(LDFLAGS) $(OBJECTS) $(LDADD) $(LIBS)
	strip --strip-unneeded Gem.pd_linux
	cp Gem.pd_linux ../../

tmp: /tmp/Gem.pd_linux
	strip --strip-unneeded /tmp/Gem.pd_linux

/tmp/Gem.pd_linux: subdirs
	$(CXXLINK) $(LDFLAGS) $(OBJECTS) $(LDADD) $(LIBS)

subdirs:
	for d in ${TARG_DIR}; do \
	    echo ""\
	    echo "----------$$d----------"; \
	    cd $$d && ${MAKE} -j4|| exit -1; \
	done


depend:
	@for d in ${TARG_DIR}; do \
	    echo "\n----------$$d----------"; \
	    cd $$d ; ${MAKE} depend; cd ../Gnu; \
	done


clean:
	@for d in ${TARG_DIR}; do \
	    echo "\n----------$$d----------"; \
	    cd $$d ; ${MAKE} clean;cd ../Gnu; \
	done
	-rm Gem.pd_linux *~

distclean: clean
	-rm ../../Gem.pd_linux
	@for d in ${TARG_DIR}; do \
	  echo "\n----------$$d----------"; \
	  cd $$d ; ${MAKE} distclean;cd ../Gnu; \
	done
	-rm config.cache config.log config.status Makefile
	./makeauxlibs clean
	cp Makefile.clean Makefile


install: installdocs
	install -m644 -D ../../Gem.pd_linux $(DESTDIR)/$(PDLIBDIR)/extra/Gem.pd_linux

installdocs:
	install -d $(DESTDIR)/$(PDLIBDIR)/doc/gem
	install -d $(DESTDIR)/$(PDLIBDIR)/doc/gem/examples
	for d in ../../examples/*.*; do \
	  dudu=$${d#../../examples/}; \
	  install -d $(DESTDIR)/$(PDLIBDIR)/doc/gem/examples/$$dudu; \
	  install -m644 $$d/*.* $(DESTDIR)/$(PDLIBDIR)/doc/gem/examples/$$dudu; \
	done

	install -d $(DESTDIR)/$(PDLIBDIR)/doc/gem/manual
	install -m644 ../../manual/*.* $(DESTDIR)/$(PDLIBDIR)/doc/gem/manual

	install -m644 ../../doc/*.* $(DESTDIR)/$(PDLIBDIR)/doc/gem/

	install -d $(DESTDIR)/$(PDLIBDIR)/@REFERENCEPATH@
	install -m644 ../../help/*.* $(DESTDIR)/$(PDLIBDIR)/@REFERENCEPATH@

## don't use this, just a remembrance
installdocs_sys:
#	install -d $(DESTDIR)/$(SYSTEMDOCS)
#	install -m644 ../../doc/*.* $(DESTDIR)/$(SYSTEMDOCS)
	install -d $(DESTDIR)/$(PDLIBDIR)/doc/gem
	install -m644 ../../examples/*.* $(DESTDIR)/$(PDLIBDIR)/doc/gem

	install -d $(DESTDIR)/$(PDLIBDIR)/doc/5.reference/Gem
	install -m644 ../../help/*.* $(DESTDIR)/$(PDLIBDIR)/doc/5.reference/Gem

#	cp -r ../../examples $(DESTDIR)/$(SYSTEMDOCS)
#	cp -r ../../manual $(DESTDIR)/$(SYSTEMDOCS)

#	ln -fs $(SYSTEMDOCS) $(DESTDIR)/$(PDLIBDIR)/doc/

#	touch $(DESTDIR)/$(SYSTEMDOCS)/CVS
#	rm -rf `find $(DESTDIR)/$(SYSTEMDOCS) -name *CVS*`

